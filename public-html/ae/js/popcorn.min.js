/*
 * popcorn.js version v1.5.7
 * http://popcornjs.org
 *
 * Copyright 2011, Mozilla Foundation
 * Licensed under the MIT license
 */

!function(){if(!document.addEventListener&&!document.removeEventListener&&!document.dispatchEvent){var t={},e=function(e,n){return e="DOMContentLoaded"===e?"readystatechange":e,Event[e.toUpperCase()]||"readystatechange"===e?void document.attachEvent("on"+e,n):(t[e]||(t[e]={events:[],queue:[],active:!1}),void(t[e].active?t[e].queue.push(n):t[e].events.push(n)))},n=function(e,n){e="DOMContentLoaded"===e?"readystatechange":e;var a=0,r=t[e];if(Event[e.toUpperCase()]||"readystatechange"===e)return void document.detachEvent("on"+e,n);if(r){for(a=r.events.length-1;a>=0;a--)n===r.events[a]&&delete r.events[a];for(a=r.queue.length-1;a>=0;a--)n===r.queue[a]&&delete r.queue[a]}},a=function(e){var n,a,r,i,s=this,o=e.type;if(o||(o=e,a=Popcorn.events.getInterface(o),a&&(n=document.createEvent(a),n.initCustomEvent(o,!0,!0,window,1))),r=t[o]){r.active=!0;for(var d=0;d<r.events.length;d++)r.events[d]&&r.events[d].call(s,n,s);if(r.queue.length)for(;r.queue.length;)i=r.queue.shift(),i&&r.events.push(i);r.active=!1,r.events.forEach(function(t){t||r.events.splice(r.events.indexOf(t),1)}),r.queue.forEach(function(t){t||r.queue.splice(r.queue.indexOf(t),1)})}};document.addEventListener=e,document.removeEventListener=n,document.dispatchEvent=a}Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),window.addEventListener=window.addEventListener||function(t,e){t="on"+t,window.attachEvent(t,e)},window.removeEventListener=window.removeEventListener||function(t,e){t="on"+t,window.detachEvent(t,e)},HTMLScriptElement.prototype.addEventListener=HTMLScriptElement.prototype.addEventListener||function(t,e){t="load"===t?"onreadystatechange":"on"+t,"onreadystatechange"===t&&(e.readyStateCheck=e.readyStateCheck||function(t){"loaded"===self.readyState&&e(t)}),this.attachEvent(t,e.readyStateCheck||e)},HTMLScriptElement.prototype.removeEventListener=HTMLScriptElement.prototype.removeEventListener||function(t,e){t="load"===t?"onreadystatechange":"on"+t,this.detachEvent(t,e.readyStateCheck||e)},document.createEvent=document.createEvent||function(){return{type:null,target:null,currentTarget:null,cancelable:!1,detail:!1,bubbles:!1,initEvent:function(t){this.type=t},initCustomEvent:function(t,e,n,a){this.type=t,this.detail=a},stopPropagation:function(){},stopImmediatePropagation:function(){}}},Array.prototype.forEach=Array.prototype.forEach||function(t,e){var n=this,a=Object.prototype.hasOwnProperty;if(!n||!t)return{};e=e||this;var r;for(r in n)a.call(n,r)&&t.call(e,n[r],r,n);return n},Array.prototype.map||(Array.prototype.map=function(t,e){var n,a,r;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),s=i.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(n=e),a=new Array(s),r=0;s>r;){var o,d;r in i&&(o=i[r],d=t.call(n,o,r,i),a[r]=d),r++}return a}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var a=0;if(arguments.length>0&&(a=Number(arguments[1]),a!=a?a=0:0!=a&&1/0!=a&&a!=-1/0&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=n)return-1;for(var r=a>=0?a:Math.max(n-Math.abs(a),0);n>r;r++)if(r in e&&e[r]===t)return r;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var i,s,o=[];for(i in r)t.call(r,i)&&o.push(i);if(e)for(s=0;a>s;s++)t.call(r,n[s])&&o.push(n[s]);return o}}()),Object.defineProperties||(Object.defineProperties=function(t,e){function n(e){function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function a(t){return"function"==typeof t}if("object"!=typeof e||null===e)throw new TypeError("bad desc");var r={};if(n(e,"enumerable")&&(r.enumerable=!!t.enumerable),n(e,"configurable")&&(r.configurable=!!e.configurable),n(e,"value")&&(r.value=t.value),n(e,"writable")&&(r.writable=!!e.writable),n(e,"get")){var i=e.get;if(!a(i)&&"undefined"!==i)throw new TypeError("bad get");r.get=i}if(n(e,"set")){var s=e.set;if(!a(s)&&"undefined"!==s)throw new TypeError("bad set");r.set=s}if(("get"in r||"set"in r)&&("value"in r||"writable"in r))throw new TypeError("identity-confused descriptor");return r}if("object"!=typeof t||null===t)throw new TypeError("bad obj");e=Object(e);for(var a=Object.keys(e),r=[],i=0;i<a.length;i++)r.push([a[i],n(e[a[i]])]);for(var i=0;i<r.length;i++)Object.defineProperty(t,r[i][0],r[i][1]);return t})}(),function(t,e){function n(t){k.put.call(this,t)}function a(t){this.parent=t,this.byStart=[{start:-1,end:-1}],this.byEnd=[{start:-1,end:-1}],this.animating=[],this.startIndex=0,this.endIndex=0,this.previousUpdateTime=-1,this.count=1}function r(t,e,n){return t[e]&&t[e]===n}function i(t,e){var n={};for(var a in t)l.call(e,a)&&l.call(t,a)&&(n[a]=t[a]);return n}function s(t,e){return function(){if(b.plugin.debug)return t.apply(this,arguments);try{return t.apply(this,arguments)}catch(n){b.plugin.errors.push({plugin:e,thrown:n,source:t.toString()}),this.emit("pluginerror",b.plugin.errors)}}}if(e.addEventListener){var o=Array.prototype,d=Object.prototype,u=o.forEach,c=o.slice,l=d.hasOwnProperty,p=d.toString,f=t.Popcorn,h=[],v=!1,m=!1,y={events:{hash:{},apis:{}}},g=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,16)}}(),E=function(t){return Object.keys?Object.keys(t):function(t){var e,n=[];for(e in t)l.call(t,e)&&n.push(e);return n}(t)},k={put:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}},b=function(t,e){return new b.p.init(t,e||null)};b.version="@VERSION",b.isSupported=!0,b.instances=[],b.p=b.prototype={init:function(t,n){var r,i,s=this;{if("function"!=typeof t){if("string"==typeof t)try{r=e.querySelector(t)}catch(o){throw new Error("Popcorn.js Error: Invalid media element selector: "+t)}if(this.media=r||t,i=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video",this[i]=this.media,this.options=b.extend({},n)||{},this.id=this.options.id||b.guid(i),b.byId(this.id))throw new Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")");this.isDestroyed=!1,this.data={running:{cue:[]},timeUpdate:b.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:new a(this)},b.instances.push(this);var d=function(){s.media.currentTime<0&&(s.media.currentTime=0),s.media.removeEventListener("loadedmetadata",d,!1);var t,e,n,a,r,i;t=s.media.duration,e=t!=t?Number.MAX_VALUE:t+1,b.addTrackEvent(s,{start:e,end:e}),s.isDestroyed||(s.data.durationChange=function(){var t=s.media.duration,e=t+1,n=s.data.trackEvents.byStart,a=s.data.trackEvents.byEnd;n.pop(),a.pop();for(var r=a.length-1;r>0;r--)a[r].end>t&&s.removeTrackEvent(a[r]._id);for(var i=0;i<n.length;i++)n[i].end>t&&s.removeTrackEvent(n[i]._id);s.data.trackEvents.byEnd.push({start:e,end:e}),s.data.trackEvents.byStart.push({start:e,end:e})},s.media.addEventListener("durationchange",s.data.durationChange,!1)),s.options.frameAnimation?(s.data.timeUpdate=function(){b.timeUpdate(s,{}),b.forEach(b.manifest,function(t,e){if(n=s.data.running[e]){r=n.length;for(var o=0;r>o;o++)a=n[o],i=a._natives,i&&i.frame&&i.frame.call(s,{},a,s.currentTime())}}),s.emit("timeupdate"),!s.isDestroyed&&g(s.data.timeUpdate)},!s.isDestroyed&&g(s.data.timeUpdate)):(s.data.timeUpdate=function(t){b.timeUpdate(s,t)},s.isDestroyed||s.media.addEventListener("timeupdate",s.data.timeUpdate,!1))};return s.media.addEventListener("error",function(){s.error=s.media.error},!1),s.media.readyState>=1?d():s.media.addEventListener("loadedmetadata",d,!1),this}if("complete"===e.readyState)return void t(e,b);if(h.push(t),!v){v=!0;var u=function(){m=!0,e.removeEventListener("DOMContentLoaded",u,!1);for(var t=0,n=h.length;n>t;t++)h[t].call(e,b);h=null};e.addEventListener("DOMContentLoaded",u,!1)}}}},b.p.init.prototype=b.p,b.byId=function(t){for(var e=b.instances,n=e.length,a=0;n>a;a++)if(e[a].id===t)return e[a];return null},b.forEach=function(t,e,n){if(!t||!e)return{};n=n||this;var a,r;if(u&&t.forEach===u)return t.forEach(e,n);if("[object NodeList]"===p.call(t)){for(a=0,r=t.length;r>a;a++)e.call(n,t[a],a,t);return t}for(a in t)l.call(t,a)&&e.call(n,t[a],a,t);return t},b.extend=function(t){var e=t,n=c.call(arguments,1);return b.forEach(n,function(t){for(var n in t)e[n]=t[n]}),e},b.extend(b,{noConflict:function(e){return e&&(t.Popcorn=f),b},error:function(t){throw new Error(t)},guid:function(t){return b.guid.counter++,(t?t:"")+(+new Date+b.guid.counter)},sizeOf:function(t){var e=0;for(var n in t)e++;return e},isArray:Array.isArray||function(t){return"[object Array]"===p.call(t)},nop:function(){},position:function(n){if(!n.parentNode)return null;var a,r,i,s,o,d,u=n.getBoundingClientRect(),c={},l=(n.ownerDocument,e.documentElement),p=e.body;a=l.clientTop||p.clientTop||0,r=l.clientLeft||p.clientLeft||0,i=t.pageYOffset&&l.scrollTop||p.scrollTop,s=t.pageXOffset&&l.scrollLeft||p.scrollLeft,o=Math.ceil(u.top+i-a),d=Math.ceil(u.left+s-r);for(var f in u)c[f]=Math.round(u[f]);return b.extend({},c,{top:o,left:d})},disable:function(t,e){if(!t.data.disabled[e]){if(t.data.disabled[e]=!0,e in b.registryByName&&t.data.running[e])for(var n,a=t.data.running[e].length-1;a>=0;a--)n=t.data.running[e][a],n._natives.end.call(t,null,n),t.emit("trackend",b.extend({},n,{plugin:n.type,type:"trackend"}));return t}},enable:function(t,e){if(t.data.disabled[e]){if(t.data.disabled[e]=!1,e in b.registryByName&&t.data.running[e])for(var n,a=t.data.running[e].length-1;a>=0;a--)n=t.data.running[e][a],n._natives.start.call(t,null,n),t.emit("trackstart",b.extend({},n,{plugin:n.type,type:"trackstart",track:n}));return t}},destroy:function(t){var e,n,a,r,i=t.data.events,s=t.data.trackEvents;for(n in i){e=i[n];for(a in e)delete e[a];i[n]=null}for(r in b.registryByName)b.removePlugin(t,r);s.byStart.length=0,s.byEnd.length=0,t.isDestroyed||(t.data.timeUpdate&&t.media.removeEventListener("timeupdate",t.data.timeUpdate,!1),t.isDestroyed=!0),b.instances.splice(b.instances.indexOf(t),1)}}),b.guid.counter=1,b.extend(b.p,function(){var t="load play pause currentTime playbackRate volume duration preload playbackRate autoplay loop controls muted buffered readyState seeking paused played seekable ended",e={};return b.forEach(t.split(/\s+/g),function(t){e[t]=function(e){var n;return"function"==typeof this.media[t]?(null!=e&&/play|pause/.test(t)&&(this.media.currentTime=b.util.toSeconds(e)),this.media[t](),this):null!=e?(n=this.media[t],this.media[t]=e,n!==e&&this.emit("attrchange",{attribute:t,previousValue:n,currentValue:e}),this):this.media[t]}}),e}()),b.forEach("enable disable".split(" "),function(t){b.p[t]=function(e){return b[t](this,e)}}),b.extend(b.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(t,e,a){var r,i,s,o=arguments.length,d="trackadded";try{i=b.util.toSeconds(t)}catch(u){}if("number"==typeof i&&(t=i),"number"==typeof t&&2===o)a=e,e=t,t=b.guid("cue");else if(1===o)e=-1;else if(r=this.getTrackEvent(t))this.data.trackEvents.remove(t),n.end(this,r),b.removeTrackEvent.ref(this,t),d="cuechange","string"==typeof t&&2===o&&("number"==typeof e&&(a=r._natives.start),"function"==typeof e&&(a=e,e=r.start));else if(o>=2){if("string"==typeof e){try{i=b.util.toSeconds(e)}catch(u){}e=i}"number"==typeof e&&(a=a||b.nop()),"function"==typeof e&&(a=e,e=-1)}return s={id:t,start:e,end:e+1,_running:!1,_natives:{start:a||b.nop,end:b.nop,type:"cue"}},r&&(s=b.extend(r,s)),"cuechange"===d?(s._id=s.id||s._id||b.guid(s._natives.type),this.data.trackEvents.add(s),n.start(this,s),this.timeUpdate(this,null,!0),b.addTrackEvent.ref(this,s),this.emit(d,b.extend({},s,{id:t,type:d,previousValue:{time:r.start,fn:r._natives.start},currentValue:{time:e,fn:a||b.nop},track:r}))):b.addTrackEvent(this,s),this},mute:function(t){var e=null==t||t===!0?"muted":"unmuted";return"unmuted"===e&&(this.media.muted=!1,this.media.volume=this.data.state.volume),"muted"===e&&(this.data.state.volume=this.media.volume,this.media.muted=!0),this.emit(e),this},unmute:function(t){return this.mute(null==t?!1:!t)},position:function(){return b.position(this.media)},toggle:function(t){return b[this.data.disabled[t]?"enable":"disable"](this,t)},defaults:function(t,e){return b.isArray(t)?(b.forEach(t,function(t){for(var e in t)this.defaults(e,t[e])},this),this):(this.options.defaults||(this.options.defaults={}),this.options.defaults[t]||(this.options.defaults[t]={}),b.extend(this.options.defaults[t],e),this)}}),b.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange"},b.Events.Natives=b.Events.UIEvents+" "+b.Events.MouseEvents+" "+b.Events.Events,y.events.apiTypes=["UIEvents","MouseEvents","Events"],function(t,e){for(var n=y.events.apiTypes,a=t.Natives.split(/\s+/g),r=0,i=a.length;i>r;r++)e.hash[a[r]]=!0;n.forEach(function(n){e.apis[n]={};for(var a=t[n].split(/\s+/g),r=a.length,i=0;r>i;i++)e.apis[n][a[i]]=!0})}(b.Events,y.events),b.events={isNative:function(t){return!!y.events.hash[t]},getInterface:function(t){if(!b.events.isNative(t))return!1;for(var e,n,a=y.events,r=a.apiTypes,i=a.apis,s=0,o=r.length;o>s;s++)if(n=r[s],i[n][t]){e=n;break}return e},all:b.Events.Natives.split(/\s+/g),fn:{trigger:function(n,a){var r,i,s,o=this.data.events[n];if(o){if(r=b.events.getInterface(n))return i=e.createEvent(r),i.initEvent(n,!0,!0,t,1),this.media.dispatchEvent(i),this;for(s=o.slice();s.length;)s.shift().call(this,a)}return this},listen:function(t,e){var n,a,r=this,i=!0,s=b.events.hooks[t];if("function"!=typeof e)throw new Error("Popcorn.js Error: Listener is not a function");return this.data.events[t]||(this.data.events[t]=[],i=!1),s&&(s.add&&s.add.call(this,{},e),s.bind&&(t=s.bind),s.handler&&(a=e,e=function(t){s.handler.call(r,t,a)}),i=!0,this.data.events[t]||(this.data.events[t]=[],i=!1)),this.data.events[t].push(e),!i&&b.events.all.indexOf(t)>-1&&this.media.addEventListener(t,function(e){if(r.data.events[t])for(n=r.data.events[t].slice();n.length;)n.shift().call(r,e)},!1),this},unlisten:function(t,e){var n,a=this.data.events[t];if(a){if("string"==typeof e){for(var r=0;r<a.length;r++)a[r].name===e&&a.splice(r--,1);return this}if("function"==typeof e){for(;-1!==n;)n=a.indexOf(e),-1!==n&&a.splice(n,1);return this}return this.data.events[t]=null,this}}},hooks:{canplayall:{bind:"canplaythrough",add:function(t,e){var n=!1;this.media.readyState&&(setTimeout(function(){e.call(this,t)}.bind(this),0),n=!0),this.data.hooks.canplayall={fired:n}},handler:function(t,e){this.data.hooks.canplayall.fired||(e.call(this,t),this.data.hooks.canplayall.fired=!0)}}}},b.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(t){b.p[t[0]]=b.p[t[1]]=b.events.fn[t[0]]}),n.start=function(t,e){e.end>t.media.currentTime&&e.start<=t.media.currentTime&&!e._running&&(e._running=!0,t.data.running[e._natives.type].push(e),t.data.disabled[e._natives.type]||(e._natives.start.call(t,null,e),t.emit("trackstart",b.extend({},e,{plugin:e._natives.type,type:"trackstart",track:e}))))},n.end=function(t,e){var n;(e.end<=t.media.currentTime||e.start>t.media.currentTime)&&e._running&&(n=t.data.running[e._natives.type],e._running=!1,n.splice(n.indexOf(e),1),t.data.disabled[e._natives.type]||(e._natives.end.call(t,null,e),t.emit("trackend",b.extend({},e,{plugin:e._natives.type,type:"trackend",track:e}))))},a.prototype.where=function(t){return(this.parent.getTrackEvents()||[]).filter(function(e){var n,a;if(!t)return!0;for(n in t)if(a=t[n],r(e,n,a)||r(e._natives,n,a))return!0;return!1})},a.prototype.add=function(t){var e,n,a=this.byStart,r=this.byEnd;for(t&&t._id&&this.parent.data.history.push(t._id),t.start=b.util.toSeconds(t.start,this.parent.options.framerate),t.end=b.util.toSeconds(t.end,this.parent.options.framerate),e=a.length-1;e>=0;e--)if(t.start>=a[e].start){a.splice(e+1,0,t);break}for(n=r.length-1;n>=0;n--)if(t.end>r[n].end){r.splice(n+1,0,t);break}e<=this.parent.data.trackEvents.startIndex&&t.start<=this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.startIndex++,n<=this.parent.data.trackEvents.endIndex&&t.end<this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.endIndex++,this.count++},a.prototype.remove=function(t,e){if(t instanceof n&&(t=t.id),"object"==typeof t)return this.where(t).forEach(function(t){this.removeTrackEvent(t._id)},this.parent),this;var a,r,i,s,o,d=this.byStart.length,u=0,c=0,l=[],p=[],f=[],h=[];for(e=e||{};--d>-1;)a=this.byStart[u],r=this.byEnd[u],a._id||(l.push(a),p.push(r)),a._id&&(a._id!==t&&l.push(a),r._id!==t&&p.push(r),a._id===t&&(c=u,o=a)),u++;if(d=this.animating.length,u=0,d)for(;--d>-1;)i=this.animating[u],i._id||f.push(i),i._id&&i._id!==t&&f.push(i),u++;c<=this.startIndex&&this.startIndex--,c<=this.endIndex&&this.endIndex--,this.byStart=l,this.byEnd=p,this.animating=f,this.count--,s=this.parent.data.history.length;for(var v=0;s>v;v++)this.parent.data.history[v]!==t&&h.push(this.parent.data.history[v]);this.parent.data.history=h},b.addTrackEvent=function(t,e){var a;e instanceof n||(e=new n(e),e&&e._natives&&e._natives.type&&t.options.defaults&&t.options.defaults[e._natives.type]&&(a=b.extend({},e),b.extend(e,t.options.defaults[e._natives.type],a)),e._natives&&(e._id=e.id||e._id||b.guid(e._natives.type),e._natives._setup&&(e._natives._setup.call(t,e),t.emit("tracksetup",b.extend({},e,{plugin:e._natives.type,type:"tracksetup",track:e})))),t.data.trackEvents.add(e),n.start(t,e),this.timeUpdate(t,null,!0),e._id&&b.addTrackEvent.ref(t,e),t.emit("trackadded",b.extend({},e,e._natives?{plugin:e._natives.type}:{},{type:"trackadded",track:e})))},b.addTrackEvent.ref=function(t,e){return t.data.trackRefs[e._id]=e,t},b.removeTrackEvent=function(t,e){var n=t.getTrackEvent(e);n&&(n._natives._teardown&&n._natives._teardown.call(t,n),t.data.trackEvents.remove(e),b.removeTrackEvent.ref(t,e),n._natives&&t.emit("trackremoved",b.extend({},n,{plugin:n._natives.type,type:"trackremoved",track:n})))},b.removeTrackEvent.ref=function(t,e){return delete t.data.trackRefs[e],t},b.getTrackEvents=function(t){for(var e,n=[],a=t.data.trackEvents.byStart,r=a.length,i=0;r>i;i++)e=a[i],e._id&&n.push(e);return n},b.getTrackEvents.ref=function(t){return t.data.trackRefs},b.getTrackEvent=function(t,e){return t.data.trackRefs[e]},b.getTrackEvent.ref=function(t,e){return t.data.trackRefs[e]},b.getLastTrackEventId=function(t){return t.data.history[t.data.history.length-1]},b.timeUpdate=function(t,e){var n,a,r,i,s,o=t.media.currentTime,d=t.data.trackEvents.previousUpdateTime,u=t.data.trackEvents,c=u.endIndex,l=u.startIndex,p=u.byStart.length,f=u.byEnd.length,h=b.registryByName,v="trackstart",m="trackend";if(o>=d){for(;u.byEnd[c]&&u.byEnd[c].end<=o;){if(n=u.byEnd[c],r=n._natives,i=r&&r.type,r&&!h[i]&&!t[i])return void b.removeTrackEvent(t,n._id);n._running===!0&&(n._running=!1,s=t.data.running[i],s.splice(s.indexOf(n),1),t.data.disabled[i]||(r.end.call(t,e,n),t.emit(m,b.extend({},n,{plugin:i,type:m,track:n})))),c++}for(;u.byStart[l]&&u.byStart[l].start<=o;){if(a=u.byStart[l],r=a._natives,i=r&&r.type,r&&!h[i]&&!t[i])return void b.removeTrackEvent(t,a._id);a.end>o&&a._running===!1&&(a._running=!0,t.data.running[i].push(a),t.data.disabled[i]||(r.start.call(t,e,a),t.emit(v,b.extend({},a,{plugin:i,type:v,track:a})))),l++}}else if(d>o){for(;u.byStart[l]&&u.byStart[l].start>o;){if(a=u.byStart[l],r=a._natives,i=r&&r.type,r&&!h[i]&&!t[i])return void b.removeTrackEvent(t,a._id);a._running===!0&&(a._running=!1,s=t.data.running[i],s.splice(s.indexOf(a),1),t.data.disabled[i]||(r.end.call(t,e,a),t.emit(m,b.extend({},a,{plugin:i,type:m,track:a})))),l--}for(;u.byEnd[c]&&u.byEnd[c].end>o;){if(n=u.byEnd[c],r=n._natives,i=r&&r.type,r&&!h[i]&&!t[i])return void b.removeTrackEvent(t,n._id);n.start<=o&&n._running===!1&&(n._running=!0,t.data.running[i].push(n),t.data.disabled[i]||(r.start.call(t,e,n),t.emit(v,b.extend({},n,{plugin:i,type:v,track:n})))),c--}}u.endIndex=c,u.startIndex=l,u.previousUpdateTime=o,u.byStart.length<p&&u.startIndex--,u.byEnd.length<f&&u.endIndex--},b.extend(b.p,{getTrackEvents:function(){return b.getTrackEvents.call(null,this)},getTrackEvent:function(t){return b.getTrackEvent.call(null,this,t)},getLastTrackEventId:function(){return b.getLastTrackEventId.call(null,this)},removeTrackEvent:function(t){return b.removeTrackEvent.call(null,this,t),this},removePlugin:function(t){return b.removePlugin.call(null,this,t),this},timeUpdate:function(t){return b.timeUpdate.call(null,this,t),this},destroy:function(){return b.destroy.call(null,this),this}}),b.manifest={},b.registry=[],b.registryByName={},b.plugin=function(t,e,a){if(b.protect.natives.indexOf(t.toLowerCase())>=0)return void b.error("'"+t+"' is a protected function name");var r="function"==typeof e,o=["start","end","type","manifest"],d=["_setup","_teardown","start","end","frame"],u={},p=function(t,e){return t=t||b.nop,e=e||b.nop,function(){t.apply(this,arguments),e.apply(this,arguments)}};b.manifest[t]=a=a||e.manifest||{},d.forEach(function(n){e[n]=s(e[n]||b.nop,t)});var f=function(e,r){if(!r)return this;if(r.ranges&&b.isArray(r.ranges))return b.forEach(r.ranges,function(e){var n=b.extend({},r,e);delete n.ranges,this[t](n)},this),this;var i,s=r._natives={},u="";return b.extend(s,e),r._natives.type=r._natives.plugin=t,r._running=!1,s.start=s.start||s["in"],s.end=s.end||s.out,r.once&&(s.end=p(s.end,function(){this.removeTrackEvent(r._id)})),s._teardown=p(function(){var t=c.call(arguments),e=this.data.running[s.type];t.unshift(null),t[1]._running&&e.splice(e.indexOf(r),1)&&s.end.apply(this,t),t[1]._running=!1,this.emit("trackend",b.extend({},r,{plugin:s.type,type:"trackend",track:b.getTrackEvent(this,r.id||r._id)}))},s._teardown),s._teardown=p(s._teardown,function(){this.emit("trackteardown",b.extend({},r,{plugin:t,type:"trackteardown",track:b.getTrackEvent(this,r.id||r._id)}))}),r.compose=r.compose||[],"string"==typeof r.compose&&(r.compose=r.compose.split(" ")),r.effect=r.effect||[],"string"==typeof r.effect&&(r.effect=r.effect.split(" ")),r.compose=r.compose.concat(r.effect),r.compose.forEach(function(t){u=b.compositions[t]||{},d.forEach(function(t){s[t]=p(s[t],u[t])})}),r._natives.manifest=a,"start"in r||(r.start=r["in"]||0),r.end||0===r.end||(r.end=r.out||Number.MAX_VALUE),l.call(r,"toString")||(r.toString=function(){var e=["start: "+r.start,"end: "+r.end,"id: "+(r.id||r._id)];return null!=r.target&&e.push("target: "+r.target),t+" ( "+e.join(", ")+" )"}),r.target||(i="options"in a&&a.options,r.target=i&&"target"in i&&i.target),!r._id&&r._natives&&(r._id=b.guid(r._natives.type)),r instanceof n?(r._natives&&(r._id=r.id||r._id||b.guid(r._natives.type),r._natives._setup&&(r._natives._setup.call(this,r),this.emit("tracksetup",b.extend({},r,{plugin:r._natives.type,type:"tracksetup",track:r})))),this.data.trackEvents.add(r),n.start(this,r),this.timeUpdate(this,null,!0),r._id&&b.addTrackEvent.ref(this,r)):b.addTrackEvent(this,r),b.forEach(e,function(t,e){-1===o.indexOf(e)&&this.on(e,t)},this),this};b.p[t]=u[t]=function(a,s){{var o,d,u,c,p;arguments.length}if(a&&!s)s=a,a=null;else{if(o=this.getTrackEvent(a))return p=s,c=i(o,p),o._natives._update?(this.data.trackEvents.remove(o),l.call(s,"start")&&(o.start=s.start),l.call(s,"end")&&(o.end=s.end),n.end(this,o),r&&e.call(this,o),o._natives._update.call(this,o,s),this.data.trackEvents.add(o),n.start(this,o),"cue"!==o._natives.type&&this.emit("trackchange",{id:o.id,type:"trackchange",previousValue:c,currentValue:p,track:o}),this):(b.extend(o,s),this.data.trackEvents.remove(a),o._natives._teardown&&o._natives._teardown.call(this,o),b.removeTrackEvent.ref(this,a),r?f.call(this,e.call(this,o),o):(o._id=o.id||o._id||b.guid(o._natives.type),o._natives&&o._natives._setup&&(o._natives._setup.call(this,o),this.emit("tracksetup",b.extend({},o,{plugin:o._natives.type,type:"tracksetup",track:o}))),this.data.trackEvents.add(o),n.start(this,o),this.timeUpdate(this,null,!0),b.addTrackEvent.ref(this,o)),this.emit("trackchange",{id:o.id,type:"trackchange",previousValue:c,currentValue:o,track:o}),this);s.id=a}return this.data.running[t]=this.data.running[t]||[],d=this.options.defaults&&this.options.defaults[t]||{},u=b.extend({},d,s),f.call(this,r?e.call(this,u):e,u),this},a&&b.extend(e,{manifest:a});var h={fn:u[t],definition:e,base:e,parents:[],name:t};return b.registry.push(b.extend(u,h,{type:t})),b.registryByName[t]=h,u},b.plugin.errors=[],b.plugin.debug="@VERSION"===b.version,b.removePlugin=function(t,e){if(!e){if(e=t,t=b.p,b.protect.natives.indexOf(e.toLowerCase())>=0)return void b.error("'"+e+"' is a protected function name");var n,a=b.registry.length;for(n=0;a>n;n++)if(b.registry[n].name===e)return b.registry.splice(n,1),delete b.registryByName[e],delete b.manifest[e],void delete t[e]}var r,i,s=t.data.trackEvents.byStart,o=t.data.trackEvents.byEnd,d=t.data.trackEvents.animating;for(r=0,i=s.length;i>r;r++)s[r]&&s[r]._natives&&s[r]._natives.type===e&&(s[r]._natives._teardown&&s[r]._natives._teardown.call(t,s[r]),s.splice(r,1),r--,i--,t.data.trackEvents.startIndex<=r&&(t.data.trackEvents.startIndex--,t.data.trackEvents.endIndex--)),o[r]&&o[r]._natives&&o[r]._natives.type===e&&o.splice(r,1);for(r=0,i=d.length;i>r;r++)d[r]&&d[r]._natives&&d[r]._natives.type===e&&(d.splice(r,1),r--,i--)},b.compositions={},b.compose=function(t,e,n){b.manifest[t]=n=n||e.manifest||{},b.compositions[t]=e},b.plugin.effect=b.effect=b.compose;var _=/^(?:\.|#|\[)/;b.dom={debug:!1,find:function(t,n){var a=null;if(n=n||e,t){if(!_.test(t)&&(a=e.getElementById(t),null!==a))return a;try{a=n.querySelector(t)}catch(r){if(b.dom.debug)throw new Error(r)}}return a}};var w=/\?/,T={ajax:null,url:"",data:"",dataType:"",success:b.nop,type:"GET",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};b.xhr=function(t){var e;return t.dataType=t.dataType&&t.dataType.toLowerCase()||null,!t.dataType||"jsonp"!==t.dataType&&"script"!==t.dataType?(e=b.extend({},T,t),e.ajax=new XMLHttpRequest,e.ajax?("GET"===e.type&&e.data&&(e.url+=(w.test(e.url)?"&":"?")+e.data,e.data=null),e.ajax.open(e.type,e.url,e.async),"POST"===e.type&&e.ajax.setRequestHeader("Content-Type",e.contentType),e.ajax.send(e.data||null),b.xhr.httpData(e)):void 0):void b.xhr.getJSONP(t.url,t.success,"script"===t.dataType)},b.xhr.httpData=function(t){var e,n,a=null,r=null;return t.ajax.onreadystatechange=function(){if(4===t.ajax.readyState){try{a=JSON.parse(t.ajax.responseText)}catch(i){}if(e={xml:t.ajax.responseXML,text:t.ajax.responseText,json:a},!e.xml||!e.xml.documentElement){e.xml=null;try{n=new DOMParser,r=n.parseFromString(t.ajax.responseText,"text/xml"),r.getElementsByTagName("parsererror").length||(e.xml=r)}catch(i){}}t.dataType&&(e=e[t.dataType]),t.success.call(t.ajax,e)}},e},b.xhr.getJSONP=function(t,n,a){var r,i,s,o=e.head||e.getElementsByTagName("head")[0]||e.documentElement,d=e.createElement("script"),u=!1,c=[],l=/(=)\?(?=&|$)|\?\?/;a||(s=t.match(/(callback=[^&]*)/),null!==s&&s.length?(r=s[1].split("=")[1],"?"===r&&(r="jsonp"),i=b.guid(r),t=t.replace(/(callback=[^&]*)/,"callback="+i)):(i=b.guid("jsonp"),l.test(t)&&(t=t.replace(l,"$1"+i)),c=t.split(/\?(.+)?/),t=c[0]+"?",c[1]&&(t+=c[1]+"&"),t+="callback="+i),window[i]=function(t){n&&n(t),u=!0}),d.addEventListener("load",function(){a&&n&&n(),u&&delete window[i],o.removeChild(d)},!1),d.addEventListener("error",function(t){n&&n({error:t}),a||delete window[i],o.removeChild(d)},!1),d.src=t,o.insertBefore(d,o.firstChild)},b.getJSONP=b.xhr.getJSONP,b.getScript=b.xhr.getScript=function(t,e){return b.xhr.getJSONP(t,e,!0)},b.util={toSeconds:function(t,e){var n,a,r,i,s,o,d=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,u="Invalid time format";return"number"==typeof t?t:("string"!=typeof t||d.test(t)||b.error(u),n=t.split(":"),a=n.length-1,r=n[a],r.indexOf(";")>-1&&(s=r.split(";"),o=0,e&&"number"==typeof e&&(o=parseFloat(s[1],10)/e),n[a]=parseInt(s[0],10)+o),i=n[0],{1:parseFloat(i,10),2:60*parseInt(i,10)+parseFloat(n[1],10),3:3600*parseInt(i,10)+60*parseInt(n[1],10)+parseFloat(n[2],10)}[n.length||1])}},b.p.cue=b.p.exec,b.protect={natives:E(b.p).map(function(t){return t.toLowerCase()})},b.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(t,e){var n=b.p[e];b.p[e]=function(){return"undefined"!=typeof console&&console.warn&&(console.warn("Deprecated method '"+e+"', "+(null==t?"do not use.":"use '"+t+"' instead.")),b.p[e]=n),b.p[t].apply(this,[].slice.call(arguments))}}),t.Popcorn=b}else{t.Popcorn={isSupported:!1};for(var x="byId forEach extend effects error guid sizeOf isArray nop position disable enable destroyaddTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId timeUpdate plugin removePlugin compose effect xhr getJSONP getScript".split(/\s+/);x.length;)t.Popcorn[x.shift()]=function(){}}}(window,window.document),function(t){t.plugin("code",function(e){var n=!1,a=this,r=function(){var t=function(t){return function(e,r){var i=function(){n&&e.call(a,r),n&&t(i)};i()}};return t(window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame:window.mozRequestAnimationFrame?window.mozRequestAnimationFrame:function(t){window.setTimeout(t,16)})}();return e.onStart&&"function"==typeof e.onStart||(e.onStart=t.nop),e.onEnd&&"function"!=typeof e.onEnd&&(e.onEnd=void 0),e.onFrame&&"function"!=typeof e.onFrame&&(e.onFrame=void 0),{start:function(t,e){e.onStart.call(a,e),e.onFrame&&(n=!0,r(e.onFrame,e))},end:function(t,e){e.onFrame&&(n=!1),e.onEnd&&e.onEnd.call(a,e)}}},{about:{name:"Popcorn Code Plugin",version:"0.1",author:"David Humphrey (@humphd)",website:"http://vocamus.net/dave"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},onStart:{elem:"input",type:"function",label:"onStart"},onFrame:{elem:"input",type:"function",label:"onFrame",optional:!0},onEnd:{elem:"input",type:"function",label:"onEnd"}}})}(Popcorn);